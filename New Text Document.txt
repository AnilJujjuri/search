import time
from opcua import Client

# OPC UA connection settings
endpoint_url = "opc.tcp://MYTSL02946.lnties.com:53530/OPCUA/SimulationServer"

# Object identifier for your specific Object under which the devices are set
object_identifier = "85"

# Create OPC UA client
client = Client(endpoint_url)

try:
    # Connect to the OPC UA server
    client.connect()
    print("Connected!")

    # Browse and read child nodes under the Object with the specified identifier
    objects_node = client.get_objects_node()
    for child_node in objects_node.get_children():
        # Check if the child node's identifier matches your specified Object identifier
        if object_identifier in child_node.get_browse_name().Name:
            # Now, you can read the child nodes under this Object
            for device_node in child_node.get_children():
                # Read the value of each child node (e.g., the devices)
                value = device_node.get_value()
                print(f"Node Name: {device_node.get_browse_name().Name}, NodeId: {device_node.nodeid}, Value: {value}")

    # Disconnect from the OPC UA server
    client.disconnect()
    print("Disconnected!")

except Exception as e:
    print(f"Error: {str(e)}")
