import time

from opcua import Client

 

# OPC UA connection settings

endpoint_url = "opc.tcp://MYTSL02946.lnties.com:53530/OPCUA/SimulationServer"

 

# Create OPC UA client

client = Client(endpoint_url)

device_node_id = []

device_node_id_with_ns_i = []

device_node_id_without_ns_i = []

 

try:

    # Connect to the OPC UA server

    client.connect()

    print("Connected!")

 

    objects_node_id = "ns=0;i=85"

    # Get the "Objects" folder node by NodeId

    objects_node = client.get_node(objects_node_id)

 

    # Browse and list all child nodes under the "Objects" folder

    for child_node in objects_node.get_children():

        print(f"Device Node Name: {child_node.get_browse_name().Name}, NodeId: {child_node.nodeid}")

        device_node_id.append(child_node.nodeid.to_string())

 

    # Separate the list into two based on ns and i values

    for node_id in device_node_id:

        if "ns=" in node_id and ";i=" in node_id:

            device_node_id_with_ns_i.append(node_id)

        else:

            device_node_id_without_ns_i.append(node_id)

 

    # Fetch data for device_node_id_with_ns_i if needed

    telemetry_data = {}

    for node_id in device_node_id_with_ns_i:
        value = node_id.get_value()
        print(f"Node Name: {child_node.get_browse_name().Name}, NodeId: {node_id.nodeid}, Value: {value}")

       

 

        # Print the child node name, node ID, and its value

        print(f"Child Node Name: {node.get_browse_name().Name}, NodeId: {node.nodeid}, Value: {value}")

 

    # You can also fetch data for device_node_id_without_ns_i if needed

 

    # Disconnect from the OPC UA server

    client.disconnect()

    print("Disconnected!")

 

except Exception as e:

    print(f"Error: {str(e)}")



Connected!
Device Node Name: Server, NodeId: FourByteNodeId(i=2253)
Device Node Name: Aliases, NodeId: FourByteNodeId(i=23470)
Device Node Name: EnergyMeter, NodeId: FourByteNodeId(ns=3;i=1011)
Device Node Name: WeatherIndicator, NodeId: FourByteNodeId(ns=3;i=1012)
Device Node Name: Simulation, NodeId: StringNodeId(ns=3;s=85/0:Simulation)
Device Node Name: StaticData, NodeId: StringNodeId(ns=5;s=StaticData)
Device Node Name: MyObjects, NodeId: StringNodeId(ns=6;s=MyObjectsFolder)
Error: 'str' object has no attribute 'get_value'